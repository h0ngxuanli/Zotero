
ç¨€åœŸæŽ˜é‡‘ ç¨€åœŸæŽ˜é‡‘

        é¦–é¡µ
        æ²¸ç‚¹
        è¯¾ç¨‹
        ç›´æ’­
        æ´»åŠ¨
        ç«žèµ›
        å•†åŸŽ
        APP
        æ’ä»¶
            åˆ›ä½œè€…ä¸­å¿ƒ
        vip
        ä¼šå‘˜
        ç™»å½•
        æ³¨å†Œ

ç”¨ Facebook Hydra å‚æ•°é…ç½®æ¡†æž¶æ¥ç®€åŒ–ç¨‹åºé…ç½®
ç½—è¥¿çš„æ€è€ƒ
2021-06-03 19:29 1751
0x00 æ‘˜è¦

Facebook Hydra å…è®¸å¼€å‘äººå‘˜é€šè¿‡ç¼–å†™å’Œè¦†ç›–é…ç½®æ¥ç®€åŒ– Python åº”ç”¨ç¨‹åºï¼ˆ å°¤å…¶æ˜¯æœºå™¨å­¦ä¹ æ–¹é¢ ï¼‰çš„å¼€å‘ã€‚å¼€å‘äººå‘˜å¯ä»¥å€ŸåŠ©Hydraï¼Œé€šè¿‡æ›´æ”¹é…ç½®æ–‡ä»¶æ¥æ›´æ”¹äº§å“çš„è¡Œä¸ºæ–¹å¼ï¼Œè€Œä¸æ˜¯é€šè¿‡æ›´æ”¹ä»£ç æ¥é€‚åº”æ–°çš„ç”¨ä¾‹ã€‚

æœ¬æ–‡é€šè¿‡å‡ ä¸ªç¤ºä¾‹ä¸ºå¤§å®¶å±•ç¤ºå¦‚ä½•ä½¿ç”¨ã€‚
0x01 é—®é¢˜æè¿°

åœ¨æœºå™¨å­¦ä¹ çš„å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°å„ç§è°ƒæ•´å‚æ•°ï¼Œå„ç§æ¯”è¾ƒæ€§èƒ½çš„æƒ…å†µã€‚æ‰€ä»¥å¼€å‘è€…ç»å¸¸ä¼šè¿·æƒ‘ï¼š

    æˆ‘çŽ°åœ¨è¿™ä¸¤ä¸ªæ¨¡åž‹éƒ½ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆå‚æ•°æ¥ç€ï¼Ÿ
    æˆ‘éœ€è¦æ·»åŠ å‡ ä¸ªå‚æ•°ï¼Œåˆè¦ä¿®æ”¹ä»£ç ï¼Œåº”è¯¥å¦‚ä½•é˜²æ­¢æžä¹±ä»£ç ï¼Ÿ
    å¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯å¦‚æžœå¸Œæœ›æ–°æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼Œåˆ™å„ä¸ªé…ç½®æ–‡ä»¶ä¹‹é—´å¾ˆéš¾åŒæ­¥ï¼Œæˆ‘å¦‚ä½•å¤„ç†é…ç½®æ–‡ä»¶ï¼Ÿ
    æˆ‘ä»Šå¤©è·‘äº†åå‡ ä¸ªæ¨¡åž‹ï¼Œä¸€ä¸å°å¿ƒæŠŠä»–ä»¬çš„è¾“å‡ºç»™å†²æŽ‰äº†ï¼Œæˆ‘è¯¥æ€Žä¹ˆåŠžï¼Ÿ
    åå‡ ä¸ªæ¨¡åž‹çš„logä¹Ÿå®¹æ˜“è¢«è¯¯åˆ é™¤ï¼Œå¦‚ä½•é˜²æ­¢å½¼æ­¤å†²çªï¼Ÿ
    æˆ‘åœ¨å“ªé‡Œï¼Ÿæˆ‘åœ¨åšä»€ä¹ˆï¼Ÿ

è¿™äº›é—®é¢˜ï¼ŒFacebookçš„å¼€å‘äººå‘˜æ—©å·²é­é‡è¿‡ï¼Œæ·±å—å…¶å®³çš„ä»–ä»¬äºŽæ˜¯å¼€å‘å‡ºæ¥äº† Hydra æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚
0x02 æ¦‚è¿°

Hydraæä¾›äº†ä¸€ç§çµæ´»çš„æ–¹æ³•æ¥å¼€å‘å’Œç»´æŠ¤ä»£ç åŠé…ç½®ï¼Œä»Žè€ŒåŠ å¿«äº†æœºå™¨å­¦ä¹ ç ”ç©¶ç­‰é¢†åŸŸä¸­å¤æ‚åº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚ å®ƒå…è®¸å¼€å‘äººå‘˜ä»Žå‘½ä»¤è¡Œæˆ–é…ç½®æ–‡ä»¶â€œç»„åˆâ€åº”ç”¨ç¨‹åºçš„é…ç½®ã€‚è¿™è§£å†³äº†åœ¨ä¿®æ”¹é…ç½®æ—¶å¯èƒ½å‡ºçŽ°çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š

    ç»´æŠ¤é…ç½®çš„ç¨å¾®ä¸åŒçš„å‰¯æœ¬æˆ–æ·»åŠ é€»è¾‘ä»¥è¦†ç›–é…ç½®å€¼ã€‚
    å¯ä»¥åœ¨è¿è¡Œåº”ç”¨ç¨‹åºä¹‹å‰å°±ç»„æˆå’Œè¦†ç›–é…ç½®ã€‚
    åŠ¨æ€å‘½ä»¤è¡Œé€‰é¡¹å¡å®ŒæˆåŠŸèƒ½å¯å¸®åŠ©å¼€å‘äººå‘˜å‘çŽ°å¤æ‚é…ç½®å¹¶å‡å°‘é”™è¯¯ã€‚
    å¯ä»¥åœ¨æœ¬åœ°æˆ–è¿œç¨‹å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨æˆ·å¯ä»¥åˆ©ç”¨æ›´å¤šçš„æœ¬åœ°èµ„æºã€‚

Hydraæ‰¿è¯ºçš„å…¶ä»–å¥½å¤„åŒ…æ‹¬ï¼š

    ä½¿ä¸ºæ–°ç”¨ä¾‹å’Œéœ€æ±‚çš„é¡¹ç›®æ·»åŠ åŠŸèƒ½å˜å¾—æ›´åŠ å®¹æ˜“ï¼Œè€Œæ— éœ€é‡å†™å¤§é‡ä»£ç ã€‚
    å‡å°‘äº†å¤æ‚åº”ç”¨ç¨‹åºä¸­å¸¸è§çš„ä¸€äº›æ ·æ¿ä»£ç ï¼Œä¾‹å¦‚å¤„ç†é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ—¥å¿—è®°å½•å’Œå®šä¹‰å‘½ä»¤è¡Œæ ‡å¿—ã€‚

ä¸‹é¢æˆ‘ä»¬é€šè¿‡å‡ ä¸ªç®€å•ä¾‹å­ç»™å¤§å®¶æ¼”ç¤ºä¸‹å¦‚ä½•ä½¿ç”¨ã€‚
0x03 ä½¿ç”¨
3.1 å®‰è£…

é¡¹ç›®åœ°å€ä½äºŽï¼š github.com/facebookresâ€¦

å®‰è£…æ–¹å¼å¦‚ä¸‹ï¼š

 
python
å¤åˆ¶ä»£ç 
 pip install --upgrade hydra-core -i http://mirrors.aliyun.com/pypi/simple --trusted-host mirrors.aliyun.com  

3.2 ç¤ºä¾‹
3.2.1 ç¤ºä¾‹ä»£ç 

ç¤ºä¾‹ä»£ç å¦‚ä¸‹

 
python
å¤åˆ¶ä»£ç 
 import hydra @hydra.main() def app ( cfg ): print (cfg.pretty()) print ( "The user is : " + cfg.user) if __name__ == "__main__" : app()  

è¿è¡Œå¦‚ä¸‹ï¼š

 
python
å¤åˆ¶ä»£ç 
 python3 test_hydra.py +user=ua +pwd=pa  

è¾“å‡ºå¦‚ä¸‹ï¼š

 
python
å¤åˆ¶ä»£ç 
 Use OmegaConf.to_yaml(cfg) category=UserWarning, user: ua pwd: pa The user is : ua  

3.2.2 ç®€åŒ–å‚æ•°å¤„ç†

å¸¸è§çš„ä¸€ä¸ªæœºå™¨å­¦ä¹ ç¨‹åºä¸­ï¼Œæ˜¯ç”¨å¦‚ä¸‹ä»£ç æ¥å¤„ç†è¾“å…¥å’Œå„ç§å‚æ•°ã€‚

 
python
å¤åˆ¶ä»£ç 
 parser = argparse.ArgumentParser(description= 'PyTorch MNIST Example' ) parser.add_argument( '--batch-size' , type = int , default= 64 , metavar= 'N' , help = 'input batch size for training (default: 64)' ) parser.add_argument( '--test-batch-size' , type = int , default= 1000 , metavar= 'N' , help = 'input batch size for testing (default: 1000)' ) parser.add_argument( '--epochs' , type = int , default= 10 , metavar= 'N' , help = 'number of epochs to train (default: 10)' ) parser.add_argument( '--lr' , type = float , default= 0.01 , metavar= 'LR' , help = 'learning rate (default: 0.01)' )  

é€šè¿‡ç¤ºä¾‹ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨ hydra ä¹‹ä¸­ï¼Œæˆ‘ä»¬ç›´æŽ¥ä½¿ç”¨ cfg.user å°±å¯ä»¥ã€‚

è€Œä¸”è¿˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥ç›´æŽ¥å¤„ç†å‚æ•°ï¼Œæ¯”å¦‚ï¼š

 
python
å¤åˆ¶ä»£ç 
 @hydra.main( config_path= "conf" , config_name= "config" ) def my_app ( cfg: DictConfig ) -> None : print (OmegaConf.to_yaml(cfg))  

3.2.3 è¾“å‡ºç›®å½•

äººä»¬åœ¨åšç ”ç©¶æ—¶ç»å¸¸é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•ä¿å­˜è¾“å‡ºã€‚å…¸åž‹çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¼ å…¥ä¸€ä¸ªæŒ‡å®šè¾“å‡ºç›®å½•çš„å‘½ä»¤è¡Œæ ‡å¿—ï¼Œä½†è¿™å¾ˆå¿«ä¼šå˜å¾—ä¹å‘³ã€‚å½“ä½ å¸Œæœ›åŒæ—¶è¿è¡Œå¤šé¡¹ä»»åŠ¡ï¼Œå¹¶ä¸”å¿…é¡»ä¸ºæ¯ä¸ªä»»åŠ¡ä¼ é€’ä¸åŒçš„è¾“å‡ºç›®å½•æ—¶ï¼Œè¿™å°¤å…¶ä»¤äººæ¼ç«ã€‚

Hydra é€šè¿‡ä¸ºæ¯æ¬¡è¿è¡Œç”Ÿæˆè¾“å‡ºç›®å½•ï¼Œå¹¶åœ¨è¿è¡Œä»£ç ä¹‹å‰æ›´æ”¹å½“å‰å·¥ä½œç›®å½•æ¥è§£å†³æ­¤é—®é¢˜ã€‚è¿™æ ·å¯ä»¥å¾ˆå¥½åœ°å°†æ¥è‡ªåŒä¸€ sweep çš„ä»»åŠ¡åˆ†ç»„åœ¨ä¸€èµ·ï¼ŒåŒæ—¶ä¿æŒæ¯ä¸ªä»»åŠ¡ä¸Žå…¶ä»–ä»»åŠ¡çš„è¾“å‡ºåˆ†ç¦»ã€‚

æˆ‘ä»¬å¯ä»¥ç®€å•çš„æ¥çœ‹çœ‹ç›®å½•çš„å˜åŒ–ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ª outputs ç›®å½•ã€‚

å…¶å†…éƒ¨ç»„ç»‡æ˜¯æŒ‰ç…§æ—¶é—´æ¥è¿›è¡Œï¼ŒæŠŠæ¯æ¬¡è¿è¡Œçš„è¾“å‡ºï¼Œlog å’Œ é…ç½®éƒ½å½’ç±»åœ¨ä¸€èµ·ã€‚

 
python
å¤åˆ¶ä»£ç 
 â”œâ”€â”€ outputs â”‚   â””â”€â”€ 2021 -03- 21 â”‚   â”œâ”€â”€ 11 - 52 - 35 â”‚   â”‚   â”œâ”€â”€ .hydra â”‚   â”‚   â”‚   â”œâ”€â”€ config.yaml â”‚   â”‚   â”‚   â”œâ”€â”€ hydra.yaml â”‚   â”‚   â”‚   â””â”€â”€ overrides.yaml â”‚   â”‚   â””â”€â”€ test_hydra.log â”‚   â””â”€â”€ 11 - 57 - 55 â”‚   â”œâ”€â”€ .hydra â”‚   â”‚   â”œâ”€â”€ config.yaml â”‚   â”‚   â”œâ”€â”€ hydra.yaml â”‚   â”‚   â””â”€â”€ overrides.yaml â”‚   â””â”€â”€ test_hydra.log â”œâ”€â”€ test_hydra.py  

3.2.4 é…ç½®æ‰€åœ¨

æˆ‘ä»¬åˆ†åˆ«æ‰“å¼€ä¸¤ä¸ª.hydraç›®å½•ä¸‹çš„config.yamlæ–‡ä»¶çœ‹çœ‹ã€‚

å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡è¿è¡Œæ—¶å€™ï¼Œå¯¹åº”çš„å‚æ•°é…ç½®éƒ½ä¿å­˜åœ¨å…¶ä¸­ã€‚è¿™æ ·æžå¤§çš„æ–¹ä¾¿äº†ç”¨æˆ·çš„æ¯”å¯¹å’Œåˆ†æžã€‚

 
python
å¤åˆ¶ä»£ç 
 $ cat outputs/ 2021 -03- 21 / 11 - 52 - 35 /.hydra/config.yaml user: ua pwd: pa $ cat outputs/ 2021 -03- 21 / 11 - 57 - 55 /.hydra/config.yaml user: ub pwd: pb  

0x04 Multirun å¤„ç†ç»„åˆæƒ…å†µ

Multirun æ˜¯ Hydra çš„ä¸€ç§åŠŸèƒ½ï¼Œå®ƒå¯ä»¥å¤šæ¬¡è¿è¡Œä½ çš„å‡½æ•°ï¼Œæ¯æ¬¡éƒ½ç»„æˆä¸€ä¸ªä¸åŒçš„é…ç½®å¯¹è±¡ã€‚è¿™æ˜¯ä¸€ä¸ªè‡ªç„¶çš„æ‰©å±•ï¼Œå¯ä»¥è½»æ¾åœ°ç»„åˆå¤æ‚çš„é…ç½®ï¼Œå¹¶ä¸”éžå¸¸æ–¹ä¾¿åœ°è¿›è¡Œå‚æ•°æ‰«æï¼Œè€Œæ— éœ€ç¼–å†™å†—é•¿çš„è„šæœ¬ã€‚

ä¾‹å¦‚ï¼Œå¯¹äºŽä¸¤ç§å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ‰«ææ‰€æœ‰ 4 ä¸ªç»„åˆï¼Œä¸€ä¸ªå‘½ä»¤å°±æ˜¯ä¼šå®Œæˆæ‰€æœ‰ç»„åˆçš„æ‰§è¡Œï¼š

 
python
å¤åˆ¶ä»£ç 
 python test_hydra.py --multirun user=ua,ub pwd=pa,pb  

å¾—åˆ°è¾“å‡ºå¦‚ä¸‹ï¼š

 
python
å¤åˆ¶ä»£ç 
 [ 2021 -03- 27 11 : 57 : 54 , 435 ][HYDRA] Launching 4 jobs locally [ 2021 -03- 27 11 : 57 : 54 , 435 ][HYDRA] #0 : +user=ua +pwd=pa user: ua pwd: pa [ 2021 -03- 27 11 : 57 : 54 , 723 ][HYDRA] #1 : +user=ua +pwd=pb user: ua pwd: pb [ 2021 -03- 27 11 : 57 : 54 , 992 ][HYDRA] #2 : +user=ub +pwd=pa user: ub pwd: pa [ 2021 -03- 27 11 : 57 : 55 , 248 ][HYDRA] #3 : +user=ub +pwd=pb user: ub pwd: pb  

å¯ä»¥çœ‹åˆ°ç”Ÿæˆå¦‚ä¸‹ç›®å½•æ ‘ï¼Œæ¯ä¸ªå‚æ•°ç»„åˆå¯¹åº”äº†ä¸€ä¸ªç›®å½•ã€‚

 
python
å¤åˆ¶ä»£ç 
 â”œâ”€â”€ multirun â”‚   â””â”€â”€ 2021 -03- 27 â”‚   â””â”€â”€ 11 - 57 - 53 â”‚   â”œâ”€â”€ 0 â”‚   â”‚   â”œâ”€â”€ .hydra â”‚   â”‚   â”‚   â”œâ”€â”€ config.yaml â”‚   â”‚   â”‚   â”œâ”€â”€ hydra.yaml â”‚   â”‚   â”‚   â””â”€â”€ overrides.yaml â”‚   â”‚   â””â”€â”€ test_hydra.log â”‚   â”œâ”€â”€ 1 â”‚   â”‚   â”œâ”€â”€ .hydra â”‚   â”‚   â”‚   â”œâ”€â”€ config.yaml â”‚   â”‚   â”‚   â”œâ”€â”€ hydra.yaml â”‚   â”‚   â”‚   â””â”€â”€ overrides.yaml â”‚   â”‚   â””â”€â”€ test_hydra.log â”‚   â”œâ”€â”€ 2 â”‚   â”‚   â”œâ”€â”€ .hydra â”‚   â”‚   â”‚   â”œâ”€â”€ config.yaml â”‚   â”‚   â”‚   â”œâ”€â”€ hydra.yaml â”‚   â”‚   â”‚   â””â”€â”€ overrides.yaml â”‚   â”‚   â””â”€â”€ test_hydra.log â”‚   â”œâ”€â”€ 3 â”‚   â”‚   â”œâ”€â”€ .hydra â”‚   â”‚   â”‚   â”œâ”€â”€ config.yaml â”‚   â”‚   â”‚   â”œâ”€â”€ hydra.yaml â”‚   â”‚   â”‚   â””â”€â”€ overrides.yaml â”‚   â”‚   â””â”€â”€ test_hydra.log â”‚   â””â”€â”€ multirun.yaml  

0x05 å¤„ç†å¤æ‚æƒ…å†µ

å¯¹äºŽä¸€èˆ¬çš„æœºå™¨å­¦ä¹ è¿è¡Œå’Œæ™®é€špythonç¨‹åºï¼Œhydraæ˜¯éžå¸¸å¥½ç”¨çš„ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨ è£…é¥°å™¨ æ¥ç›´æŽ¥ä½œç”¨äºŽ python å‡½æ•°ã€‚

ä½†æ˜¯å¦‚æžœé‡åˆ°äº†å¤æ‚æƒ…å†µï¼Œæ¯”å¦‚spark-submitï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†ï¼Ÿå› ä¸º spark-submit æ˜¯æ²¡åŠžæ³•ç”¨ hydra æ¥è£…é¥°ã€‚

æ¯”å¦‚ï¼š

 
python
å¤åˆ¶ä»£ç 
 spark-submit cut_words.py  

è¿™æ ·å°±hydraå°±æ²¡åŠžæ³•æˆªå– spark çš„è¾“å…¥ï¼Œè¾“å‡ºã€‚

é‡åˆ°è¿™ä¸ªæƒ…å†µï¼Œæˆ‘æ˜¯ä½¿ç”¨ python æ–‡ä»¶å†…éƒ¨ è°ƒç”¨ linuxå‘½ä»¤è¡Œï¼Œç„¶åŽåœ¨spark-submitä¹‹å‰å°±å¤„ç†å…¶å‚æ•°ï¼Œåœ¨ spark è¿è¡Œæ—¶å€™ è½¬å‘ç¨‹åºè¾“å‡ºçš„åŠžæ³•æ¥è§£å†³ï¼ˆå¦‚æžœå“ªä½åŒå­¦æœ‰æ›´å¥½çš„åŠžæ³•ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œè°¢è°¢ï¼‰ã€‚
5.1 Python subprocess

Python subprocess å…è®¸ä½ åŽ»åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹è®©å…¶æ‰§è¡Œå¦å¤–çš„ç¨‹åºï¼Œå¹¶ä¸Žå®ƒè¿›è¡Œé€šä¿¡ï¼ŒèŽ·å–æ ‡å‡†çš„è¾“å…¥ã€æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯ä»¥åŠè¿”å›žç ç­‰ã€‚

subprocessæ¨¡å—ä¸­å®šä¹‰äº†ä¸€ä¸ªPopenç±»ï¼Œé€šè¿‡å®ƒå¯ä»¥æ¥åˆ›å»ºè¿›ç¨‹ï¼Œå¹¶ä¸Žå…¶è¿›è¡Œå¤æ‚çš„äº¤äº’ã€‚Popen æ˜¯ subprocessçš„æ ¸å¿ƒï¼Œå­è¿›ç¨‹çš„åˆ›å»ºå’Œç®¡ç†éƒ½é å®ƒå¤„ç†ã€‚

æž„é€ å‡½æ•°ï¼š

 
python
å¤åˆ¶ä»£ç 
 class subprocess .Popen(args, bufsize=- 1 , executable= None , stdin= None , stdout= None , stderr= None , preexec_fn= None , close_fds= True , shell= False , cwd= None , env= None , universal_newlines= False , startupinfo= None , creationflags= 0 ,restore_signals= True , start_new_session= False , pass_fds=(),*, encoding= None , errors= None )  

å¸¸ç”¨å‚æ•°ï¼š

    argsï¼šshellå‘½ä»¤ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…åºåˆ—ç±»åž‹ï¼ˆå¦‚ï¼šlistï¼Œå…ƒç»„ï¼‰
    bufsizeï¼šç¼“å†²åŒºå¤§å°ã€‚å½“åˆ›å»ºæ ‡å‡†æµçš„ç®¡é“å¯¹è±¡æ—¶ä½¿ç”¨ï¼Œé»˜è®¤-1ã€‚ 0ï¼šä¸ä½¿ç”¨ç¼“å†²åŒº 1ï¼šè¡¨ç¤ºè¡Œç¼“å†²ï¼Œä»…å½“universal_newlines=Trueæ—¶å¯ç”¨ï¼Œä¹Ÿå°±æ˜¯æ–‡æœ¬æ¨¡å¼ æ­£æ•°ï¼šè¡¨ç¤ºç¼“å†²åŒºå¤§å° è´Ÿæ•°ï¼šè¡¨ç¤ºä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„ç¼“å†²åŒºå¤§å°ã€‚
    stdin, stdout, stderrï¼šåˆ†åˆ«è¡¨ç¤ºç¨‹åºçš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºã€é”™è¯¯å¥æŸ„
    preexec_fnï¼šåªåœ¨ Unix å¹³å°ä¸‹æœ‰æ•ˆï¼Œç”¨äºŽæŒ‡å®šä¸€ä¸ªå¯æ‰§è¡Œå¯¹è±¡ï¼ˆcallable objectï¼‰ï¼Œå®ƒå°†åœ¨å­è¿›ç¨‹è¿è¡Œä¹‹å‰è¢«è°ƒç”¨
    shellï¼šå¦‚æžœè¯¥å‚æ•°ä¸º Trueï¼Œå°†é€šè¿‡æ“ä½œç³»ç»Ÿçš„ shell æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚
    cwdï¼šç”¨äºŽè®¾ç½®å­è¿›ç¨‹çš„å½“å‰ç›®å½•ã€‚
    envï¼šç”¨äºŽæŒ‡å®šå­è¿›ç¨‹çš„çŽ¯å¢ƒå˜é‡ã€‚å¦‚æžœ env = Noneï¼Œå­è¿›ç¨‹çš„çŽ¯å¢ƒå˜é‡å°†ä»Žçˆ¶è¿›ç¨‹ä¸­ç»§æ‰¿ã€‚

5.2 å…·ä½“ä¾‹å­

ä¸‹é¢ä¾‹å­å¾ˆç®€é™‹ï¼Œä¸èƒ½ç›´æŽ¥è¿è¡Œï¼Œåªæ˜¯ç»™å¤§å®¶æ¼”ç¤ºä¸‹å¤§è‡´æ€è·¯ï¼Œè¿˜è¯·æ ¹æ®å…·ä½“æƒ…å†µåšç›¸å…³è°ƒæ•´ã€‚

    æˆ‘ä»¬é€šè¿‡subprocess.Popenå¯åŠ¨äº†sparkï¼›
    hydra çš„è¾“å…¥ å¯ä»¥è½¬æ¢ä¸º spark å’Œ python çš„è¾“å…¥ï¼›
    ç„¶åŽè¯»å–å­è¿›ç¨‹çš„stdoutï¼›
    é€æ¬¡ä½¿ç”¨log.infoæ¥æ‰“å°è½¬å‘çš„stdoutï¼Œè¿™æ ·sparkçš„è¾“å‡ºå°±è¢«è½¬å‘åˆ°äº†hydraçš„è¾“å‡ºä¹‹ä¸­ï¼›

è¿™æ ·ï¼Œsparkçš„è¾“å‡ºå°±å¯ä»¥è¢«hydraæ•èŽ·ï¼Œä»Žè€Œæ•´åˆåˆ°hydra logä½“ç³»ä¹‹ä¸­ã€‚

 
python
å¤åˆ¶ä»£ç 
 import shlex import subprocess import hydra import logging log = logging.getLogger(__name__) @hydra.main() def app ( cfg ): # å¯ä»¥åœ¨è¿™é‡Œäº‹å…ˆå¤„ç†å‚æ•°ï¼Œè¢«hydraå¤„ç†ä¹‹åŽï¼Œä¹Ÿæˆä¸º spark å’Œ python çš„è¾“å…¥ï¼Œè¿›è¡Œå¤„ç† shell_cmd = 'spark-submit cut_words.py' + cfg.xxxxxx # å‡å¦‚cut_wordsæœ‰å‚æ•° cmd = shlex.split(shell_cmd) p = subprocess.Popen(cmd, shell= False , stdout=subprocess.PIPE, stderr=subprocess.STDOUT) while p.poll() is None : line = p.stdout.readline() line = line.strip() if line: log.info( 'Subprogram output: [{}]' . format (line)) if p.returncode == 0 : log.info( 'Subprogram success' ) else : log.info( 'Subprogram failed' ) if __name__ == '__main__' : app()  

5.3 æµç¨‹ç¤ºä¾‹

ä»¥ä¸‹å°±æ˜¯æˆ‘é‡‡å–åŠžæ³•çš„æµç¨‹ç¤ºä¾‹ã€‚

    Input ç”± hydra å¤„ç†ä¹‹åŽï¼Œç”± python çˆ¶è¿›ç¨‹ è½¬å‘ç»™ spark å’Œ æˆ‘ä»¬çš„python å•†ä¸šé€»è¾‘ï¼›
    å…·ä½“spark çš„è¾“å‡ºï¼Œç”± python çˆ¶è¿›ç¨‹è½¬å‘ç»™ Hydra loggingï¼›

å…·ä½“å¦‚ä¸‹å›¾ï¼š

 
python
å¤åˆ¶ä»£ç 
 Input Input Hydra +----------+ +------------------------v | ^ | | | | | | | +-------------------------+ v | | | | +------+-------------+ | v +----------> | | Spark | | | | | | Parent Python Process | | Business Python | | | | | | +<-----------^ | | | | | | | | | +-------------------------+ +------+-------------+ | | | | | | | | | Hydra <---------<+ +------------------------+ Logging Output  

5.4 æœŸå¾…

çŽ°åœ¨ Hydra ç»Ÿä¸€ä¿å­˜ é…ç½® åˆ°ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ä¹‹ä¸­ã€‚å¦‚æžœå¯ä»¥æŠŠæŸäº›è¾“å‡ºä¹ŸæŒ‰ç…§ç»Ÿä¸€æ ¼å¼ä¿å­˜åœ¨é…ç½®æ–‡ä»¶ä¸­å°±æ›´å¥½äº†ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™äº›é…ç½®æ–‡ä»¶ç»Ÿä¸€å¤„ç†ï¼Œæ¯”è¾ƒï¼Œå›¾å½¢åŒ–ã€‚ç›´æŽ¥æŠŠé…ç½®å’Œè¾“å‡ºç»“åˆèµ·æ¥ï¼Œæ›´åŠ ç›´è§‚ã€‚
0x06 æ€»ç»“

è¿™é‡Œåªæ˜¯ç®€å•ç»™å‡ºäº†ä¸‰ä¸ªä¾‹å­ï¼ŒHydraè¿˜æœ‰ä¼—å¤šçš„ç”¨æ³•ç­‰å¾…å¤§å®¶åŽ»æŽ¢ç©¶ã€‚ç›¸ä¿¡å¤§å®¶çš„å¾ˆå¤šç—›ç‚¹éƒ½å¯ä»¥ç”¨å®ƒæ¥è§£å†³ï¼Œèµ¶ç´§è¯•è¯•å§ã€‚
0xFF å‚è€ƒ

æœºå™¨å­¦ä¹ é¡¹ç›®é…ç½®å¤ªå¤æ‚æ€Žä¹ˆåŠžï¼ŸFacebook å¼€å‘äº† Hydra æ¥å¸®ä½ 

Python ä»Žsubprocessè¿è¡Œçš„å­è¿›ç¨‹ä¸­å®žæ—¶èŽ·å–è¾“å‡ºçš„ä¾‹å­
æ ‡ç­¾ï¼š
æœºå™¨å­¦ä¹ 
æ–‡ç« è¢«æ”¶å½•äºŽä¸“æ ï¼š
cover
æ·±åº¦å­¦ä¹ 
å…³äºŽæ·±åº¦å­¦ä¹ çš„è®ºæ–‡è§£è¯»ï¼Œä»£ç åˆ†æžï¼Œæ¦‚å¿µå‰–æžç­‰ç­‰ã€‚
è®¢é˜…ä¸“æ 
ç›¸å…³å°å†Œ
ã€ŒæŽ¨èç³»ç»Ÿå®Œå…¨æŒ‡å—ã€å°é¢
VIP
æŽ¨èç³»ç»Ÿå®Œå…¨æŒ‡å—
å‘¨å…´åš åˆ›ä½œç­‰çº§LV.3
448è´­ä¹°
Â¥19.95
Â¥39.9
é¦–å•åˆ¸åŽä»·
ã€Œæ™ºèƒ½åŒ–æµ‹è¯•å…¥é—¨è¯¾ã€å°é¢
VIP
æ™ºèƒ½åŒ–æµ‹è¯•å…¥é—¨è¯¾
Crissé™ˆç£Š åˆ›ä½œç­‰çº§LV.3
3030è´­ä¹°
Â¥0.05
Â¥0.1
é¦–å•åˆ¸åŽä»·
è¯„è®º
çœ‹å®Œå•¦ï¼Œ
ç™»å½•
åˆ†äº«ä¸€ä¸‹æ„Ÿå—å§ï½ž
ç›¸å…³æŽ¨è
ourlang
1å¹´å‰
åŽç«¯
ORY Hydraé¡¹ç›®è¯¦è§£

    1547
    2
    1

LexSaints
2å¹´å‰
Linux
ã€æ¸—é€æµ‹è¯•ã€‘å¯†ç çˆ†ç ´å·¥å…·â€”â€”ä¹å¤´è›‡ï¼ˆhydraï¼‰ä½¿ç”¨è¯¦è§£åŠå®žæˆ˜

    2.5w
    19
    15

ã€æ¸—é€æµ‹è¯•ã€‘å¯†ç çˆ†ç ´å·¥å…·â€”â€”ä¹å¤´è›‡ï¼ˆhydraï¼‰ä½¿ç”¨è¯¦è§£åŠå®žæˆ˜
éžä¼˜ç§€ç¨‹åºå‘˜
1å¹´å‰
å‰ç«¯ JavaScript
å¦‚ä½•ç”¨ CSS ä¸­å†™å‡ºè¶…çº§ç¾Žä¸½çš„é˜´å½±æ•ˆæžœ

    115.8w
    1133
    74

ssh_æ™¨æ›¦æ—¶æ¢¦è§å…®
2å¹´å‰
JavaScript å‰ç«¯
Facebook é‡æž„ï¼šæŠ›å¼ƒ Sass / Less ï¼Œè¿ŽæŽ¥åŽŸå­åŒ– CSS æ—¶ä»£

    5.4w
    782
    199

Facebook é‡æž„ï¼šæŠ›å¼ƒ Sass / Less ï¼Œè¿ŽæŽ¥åŽŸå­åŒ– CSS æ—¶ä»£
é“¶æ²³1å·
4å¹´å‰
äººå·¥æ™ºèƒ½
ä½¿ç”¨Facebookçš„FastTextç®€åŒ–æ–‡æœ¬åˆ†ç±»

    2843
    10
    è¯„è®º

dragonir
1å¹´å‰
three.js å‰ç«¯
Three.jså®žçŽ°è„¸ä¹¦å…ƒå®‡å®™3DåŠ¨æ€Logo

    2.2w
    163
    19

Three.jså®žçŽ°è„¸ä¹¦å…ƒå®‡å®™3DåŠ¨æ€Logo
Asuka109
2å¹´å‰
NPM
npm-run-all ç®€åŒ–scripté…ç½®

    1.4w
    38
    7

ç¨‹åºå‘˜è€é±¼
4æœˆå‰
æŽ˜é‡‘Â·æ—¥æ–°è®¡åˆ’ ChatGPT OpenAI
ChatGPTä¿å§†çº§æ•™ç¨‹ï¼Œä¸€åˆ†é’Ÿå­¦ä¼šä½¿ç”¨ChatGPTï¼

    69.9w
    460
    421

ChatGPTä¿å§†çº§æ•™ç¨‹ï¼Œä¸€åˆ†é’Ÿå­¦ä¼šä½¿ç”¨ChatGPTï¼
ConardLi
2å¹´å‰
React.js JavaScript
Facebook æ–°ä¸€ä»£ React çŠ¶æ€ç®¡ç†åº“ Recoil

    2.0w
    252
    49

çº¢å°˜ç‚¼å¿ƒ
1å¹´å‰
å‰ç«¯ Vue.js React.js
ä½ ä¼šç”¨ES6ï¼Œé‚£å€’æ˜¯ç”¨å•Šï¼

    39.3w
    9244
    1471

Blankj
5å¹´å‰
é¢è¯•
Facebooké¢ç»è®°

    7296
    174
    31

åƒå¤å£¹å·
4å¹´å‰
Visual Studio Code
ç¬¬ä¸€æ¬¡ä½¿ç”¨VS Codeæ—¶ä½ åº”è¯¥çŸ¥é“çš„ä¸€åˆ‡é…ç½®

    12.4w
    385
    16

ä¼˜å¼§
7æœˆå‰
OpenAI ç¨‹åºå‘˜ å‰ç«¯
OpenAI æŽ¨å‡ºè¶…ç¥ž ChatGPT æ³¨å†Œæ”»ç•¥æ¥äº†

    43.3w
    906
    598

OpenAI æŽ¨å‡ºè¶…ç¥ž ChatGPT æ³¨å†Œæ”»ç•¥æ¥äº†
èš‚èšé›†å›¢æ•°æ®ä½“éªŒæŠ€æœ¯
5å¹´å‰
Webpack Node.js å‰ç«¯
Webpack 4 é…ç½®æœ€ä½³å®žè·µ

    4.4w
    1728
    38

Webpack 4 é…ç½®æœ€ä½³å®žè·µ
äº•æŸç„¶
1å¹´å‰
Vue.js Element
å‰ç«¯é…ç½®åŒ–çœŸé¦™ï½žä¸Šç­åˆå¤šäº†60%çš„æ‘¸ðŸŸæ—¶é—´

    10.8w
    1375
    283

å‰ç«¯é…ç½®åŒ–çœŸé¦™ï½žä¸Šç­åˆå¤šäº†60%çš„æ‘¸ðŸŸæ—¶é—´
ç½—è¥¿çš„æ€è€ƒ åˆ›ä½œç­‰çº§LV.5
å…³æ³¨
ç§ä¿¡
èŽ·å¾—ç‚¹èµž  472
æ–‡ç« è¢«é˜…è¯»  231,654
ç›¸å…³æ–‡ç« 
[æºç è§£æž] PyTorchåˆ†å¸ƒå¼ä¼˜åŒ–å™¨(3)---- æ¨¡åž‹å¹¶è¡Œ
5ç‚¹èµž
 Â· 
1è¯„è®º
[æºç è§£æž] æ¨¡åž‹å¹¶è¡Œåˆ†å¸ƒå¼è®­ç»ƒ Megatron (4) --- å¦‚ä½•è®¾ç½®å„ç§å¹¶è¡Œ
7ç‚¹èµž
 Â· 
0è¯„è®º
[æºç è§£æž] PyTorch åˆ†å¸ƒå¼ Autograd (6) ---- å¼•æ“Ž(ä¸‹)
3ç‚¹èµž
 Â· 
0è¯„è®º
[ç™½è¯è§£æž] æ·±å…¥æµ…å‡ºç†µçš„æ¦‚å¿µ & å†³ç­–æ ‘ä¹‹ID3ç®—æ³•
4ç‚¹èµž
 Â· 
0è¯„è®º
[æºç è§£æž] PyTorch åˆ†å¸ƒå¼ä¹‹ ZeroRedundancyOptimizer
4ç‚¹èµž
 Â· 
1è¯„è®º
é™æ—¶é¢†æŽ˜é‡‘ä¼šå‘˜
ç›®å½•

    0x00 æ‘˜è¦
    0x01 é—®é¢˜æè¿°
    0x02 æ¦‚è¿°
    0x03 ä½¿ç”¨
        3.1 å®‰è£…
        3.2 ç¤ºä¾‹
            3.2.1 ç¤ºä¾‹ä»£ç 
            3.2.2 ç®€åŒ–å‚æ•°å¤„ç†
            3.2.3 è¾“å‡ºç›®å½•
            3.2.4 é…ç½®æ‰€åœ¨
    0x04 Multirun å¤„ç†ç»„åˆæƒ…å†µ
    0x05 å¤„ç†å¤æ‚æƒ…å†µ
        5.1 Python subprocess
        5.2 å…·ä½“ä¾‹å­
        5.3 æµç¨‹ç¤ºä¾‹
        5.4 æœŸå¾…
    0x06 æ€»ç»“
    0xFF å‚è€ƒ

ä¸‹ä¸€ç¯‡
[æºç è§£æž] PyTorch åˆ†å¸ƒå¼ä¹‹å¼¹æ€§è®­ç»ƒ(5)---Rendezvous å¼•æ“Ž
ç™»å½•æŽ˜é‡‘åŽå¯ç«‹å³èŽ·å¾—ä»¥ä¸‹æƒç›Šï¼š

    å…è´¹è¯•å­¦è¯¾ç¨‹
    æ”¶è—æœ‰ç”¨æ–‡ç« 
    æŸ¥é˜…æµè§ˆè¶³è¿¹
    è®¢é˜…ä¼˜è´¨ä¸“æ 
    ä½“éªŒç­¾åˆ°æŠ½å¥–
    æå‡æˆé•¿ç­‰çº§ 

ç«‹å³ç™»å½•
é¦–æ¬¡ä½¿ç”¨ï¼Ÿ
ç‚¹æˆ‘æ³¨å†Œ
æ²‰æµ¸é˜…è¯»
